(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{571:function(t,s,a){"use strict";a.r(s);var n=a(16),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("在以前使用部署描述符web.xml时，配置过滤器是很明了的事情。我之前一直不是很重视过滤器（是因为不常手写），然而在Spring Security中，过滤器是核心实现原理之一，了解过滤器的执行原理是了解Spring Security执行原理的基础。本文就过滤器在Spring Boot中的注册说起。")]),t._v(" "),a("h2",{attrs:{id:"webfilter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webfilter"}},[t._v("#")]),t._v(" "),a("code",[t._v("@WebFilter")])]),t._v(" "),a("p",[t._v("该注解位于"),a("code",[t._v("javax.servlet.annotation")]),t._v("包下，属于Servlet规范定义的内容，与Spring体系无关。可以用该注解修饰"),a("code",[t._v("javax.servlet.Filter")]),t._v("的实现类，即可实现"),a("code",[t._v("Filter")]),t._v("的注册。可以通过该注解的"),a("code",[t._v("value")]),t._v("或"),a("code",[t._v("urlPatterns")]),t._v("属性传递该拦截器的拦截规则。另外，需要在项目主类上配置"),a("code",[t._v("@ServletComponentScan")]),t._v("注解，否则"),a("code",[t._v("@WebFilter")]),t._v("不生效。很明显，这种方式注册无法指定过滤器的优先级。")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("在servlet容器启动时，容器会找到被该注解所修饰的类，至于是怎么找到的，目前不是很清楚，需要参考各自servlet容器的实现。")])]),t._v(" "),a("h2",{attrs:{id:"bean"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bean"}},[t._v("#")]),t._v(" "),a("code",[t._v("@Bean")])]),t._v(" "),a("p",[t._v("将过滤器配置成普通的bean，这种方法不再需要"),a("code",[t._v("@ServletComponentScan")]),t._v("。另外，可以通过"),a("code",[t._v("@Order")]),t._v("注解指定过滤器的优先级。这种方式配置的过滤器无法指定拦截规则，只能是"),a("code",[t._v("/*")]),t._v("，即拦截所有的请求。")]),t._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[t._v("笔记")]),t._v(" "),a("p",[t._v("拦截器的规则之区别："),a("code",[t._v("/")]),t._v("和"),a("code",[t._v("/*")]),t._v("，前者不会拦截静态资源，而后者拦截所有请求。")])]),t._v(" "),a("p",[t._v("特别注意，不要加了"),a("code",[t._v("@WebFilter")]),t._v("，还让该filter成为Spring容器中的bean，否则会产生两次重复拦截。")]),t._v(" "),a("h2",{attrs:{id:"filterregistrationbean"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#filterregistrationbean"}},[t._v("#")]),t._v(" "),a("code",[t._v("FilterRegistrationBean")])]),t._v(" "),a("p",[t._v("这种方案本质上还是将filter封装成一个bean，但这个bean是"),a("code",[t._v("FilterRegistrationBean")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FilterRegistrationBean")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("myFilterFilterRegistrationBean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FilterRegistrationBean")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" bean "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FilterRegistrationBean")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    bean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    bean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setOrder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    bean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUrlPatterns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Arrays")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("asList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" bean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[t._v("可以发现，"),a("code",[t._v("FilterRegistrationBean")]),t._v("封装了filter，并且还可以设置优先级和请求规则，两全其美。")]),t._v(" "),a("p",[t._v("下面是"),a("code",[t._v("FilterRegistrationBean")]),t._v("的继承类图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://imgconvert.csdnimg.cn/aHR0cDovL2ltZy5pdGJveWh1Yi5jb20vMjAyMC8wNi9SZWdpc3RyYXRpb25CZWFuLnBuZw?x-oss-process=image/format,png",alt:""}})]),t._v(" "),a("p",[t._v("在继承链的顶部有一个接口叫做"),a("code",[t._v("ServletContextInitializer")]),t._v("，该接口中定义了一个叫做"),a("code",[t._v("onStartup()")]),t._v("方法，在servlet容器启动的时候，该方法会被调用。还是老套路，在整个继承链中多次使用了模板方法的设计模式，看一下源码就知道过滤器是怎么被注册的了，最终是通过"),a("code",[t._v("ServletContext")]),t._v("中的"),a("code",[t._v("addFilter()")]),t._v("方法实现的。")])])}),[],!1,null,null,null);s.default=e.exports}}]);