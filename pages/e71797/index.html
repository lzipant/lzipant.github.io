<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JDBC API概述 | harrison&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="后端技术博客,简洁至上,专注Java学习与总结。Java, Spring, SpringBoot, SpringCloud, MyBatis, Netty, RabbitMQ, Kafka, Dubbo, Linux, Linux Kernel等技术文章。">
    <meta name="keywords" content="后端技术博客">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.db69af13.css" as="style"><link rel="preload" href="/assets/js/app.36e91a11.js" as="script"><link rel="preload" href="/assets/js/2.409e0185.js" as="script"><link rel="preload" href="/assets/js/23.99984d12.js" as="script"><link rel="prefetch" href="/assets/js/10.1206fbe6.js"><link rel="prefetch" href="/assets/js/11.811b7408.js"><link rel="prefetch" href="/assets/js/12.83e62cf0.js"><link rel="prefetch" href="/assets/js/13.3da6fa14.js"><link rel="prefetch" href="/assets/js/14.be23cced.js"><link rel="prefetch" href="/assets/js/15.5b1701fd.js"><link rel="prefetch" href="/assets/js/16.3d55b70f.js"><link rel="prefetch" href="/assets/js/17.7429b142.js"><link rel="prefetch" href="/assets/js/18.796642e8.js"><link rel="prefetch" href="/assets/js/19.ffb2f3b3.js"><link rel="prefetch" href="/assets/js/20.9b77edb3.js"><link rel="prefetch" href="/assets/js/21.45f0bd1c.js"><link rel="prefetch" href="/assets/js/22.05843092.js"><link rel="prefetch" href="/assets/js/24.6a89fd33.js"><link rel="prefetch" href="/assets/js/25.16160e78.js"><link rel="prefetch" href="/assets/js/26.471a561c.js"><link rel="prefetch" href="/assets/js/27.ff9b36a8.js"><link rel="prefetch" href="/assets/js/28.d235529f.js"><link rel="prefetch" href="/assets/js/29.ac8ca018.js"><link rel="prefetch" href="/assets/js/3.1c6d2763.js"><link rel="prefetch" href="/assets/js/30.96538408.js"><link rel="prefetch" href="/assets/js/31.47118b60.js"><link rel="prefetch" href="/assets/js/32.fb74aca4.js"><link rel="prefetch" href="/assets/js/33.d059016b.js"><link rel="prefetch" href="/assets/js/34.c1f0aff0.js"><link rel="prefetch" href="/assets/js/35.1b63946e.js"><link rel="prefetch" href="/assets/js/36.305c9ab9.js"><link rel="prefetch" href="/assets/js/37.1f8690b8.js"><link rel="prefetch" href="/assets/js/38.6a0faec0.js"><link rel="prefetch" href="/assets/js/39.6a4f34cc.js"><link rel="prefetch" href="/assets/js/4.f0a8c30f.js"><link rel="prefetch" href="/assets/js/40.2d767369.js"><link rel="prefetch" href="/assets/js/41.f6602ec0.js"><link rel="prefetch" href="/assets/js/42.d86dc81f.js"><link rel="prefetch" href="/assets/js/43.3193e48c.js"><link rel="prefetch" href="/assets/js/44.ba2bfbed.js"><link rel="prefetch" href="/assets/js/45.c855ea02.js"><link rel="prefetch" href="/assets/js/46.cc0695f3.js"><link rel="prefetch" href="/assets/js/47.9356ab33.js"><link rel="prefetch" href="/assets/js/48.04ed80cc.js"><link rel="prefetch" href="/assets/js/49.3b625cf2.js"><link rel="prefetch" href="/assets/js/5.e688792f.js"><link rel="prefetch" href="/assets/js/50.45f22e5f.js"><link rel="prefetch" href="/assets/js/51.e28308a2.js"><link rel="prefetch" href="/assets/js/52.2d74a9f7.js"><link rel="prefetch" href="/assets/js/53.9ea65ca6.js"><link rel="prefetch" href="/assets/js/54.b92ef08c.js"><link rel="prefetch" href="/assets/js/55.c96f6cd9.js"><link rel="prefetch" href="/assets/js/56.66e76778.js"><link rel="prefetch" href="/assets/js/57.290715f8.js"><link rel="prefetch" href="/assets/js/58.68f33ada.js"><link rel="prefetch" href="/assets/js/59.a0c46087.js"><link rel="prefetch" href="/assets/js/6.feb75664.js"><link rel="prefetch" href="/assets/js/60.942b9285.js"><link rel="prefetch" href="/assets/js/7.3e34b1bc.js"><link rel="prefetch" href="/assets/js/8.e4dd00a2.js"><link rel="prefetch" href="/assets/js/9.74704eea.js">
    <link rel="stylesheet" href="/assets/css/0.styles.db69af13.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/HL-logo.png" alt="harrison's blog" class="logo"> <span class="site-name can-hide">harrison's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><!----> <span class="title" style="display:;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/collections/websites/" class="nav-link">网站</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/HarrisonLee1998/image/avatar.jpg"> <div class="blogger-info"><h3>Harrison Lee</h3> <span>玻璃晴朗，橘子辉煌</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><!----> <span class="title" style="display:;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/collections/websites/" class="nav-link">网站</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>集合</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>线程与并发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>JVM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>JDBC</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e71797/" aria-current="page" class="active sidebar-link">JDBC API概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/e71797/#建立数据源连接" class="sidebar-link">建立数据源连接</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#执行sql语句" class="sidebar-link">执行SQL语句</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#处理sql语句执行结果" class="sidebar-link">处理SQL语句执行结果</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#关闭连接" class="sidebar-link">关闭连接</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#jdbc-api中的类与接口" class="sidebar-link">JDBC API中的类与接口</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/e71797/#java-sql" class="sidebar-link">java.sql</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#javax-sql" class="sidebar-link">javax.sql</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/e71797/#driver与drivermanager" class="sidebar-link">Driver与DriverManager</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#datasource" class="sidebar-link">DataSource</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#statement" class="sidebar-link">Statement</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#resultset" class="sidebar-link">ResultSet</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/e71797/#游标操作方式和敏感性" class="sidebar-link">游标操作方式和敏感性</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#并行性" class="sidebar-link">并行性</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#可保持性" class="sidebar-link">可保持性</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#关闭resultset" class="sidebar-link">关闭ResultSet</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/e71797/#事务" class="sidebar-link">事务</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#databasemetadata" class="sidebar-link">DatabaseMetaData</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#常见数据库的驱动实现类名和url格式" class="sidebar-link">常见数据库的驱动实现类名和URL格式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/e71797/#mysql" class="sidebar-link">MySQL</a></li><li class="sidebar-sub-header"><a href="/pages/e71797/#oracle" class="sidebar-link">Oracle</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/e71797/#参考" class="sidebar-link">参考</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-1"><div class="articleInfo-wrap" data-v-33863c7e><div class="articleInfo" data-v-33863c7e><ul class="breadcrumbs" data-v-33863c7e><li data-v-33863c7e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-33863c7e></a></li> <li data-v-33863c7e><a href="/categories/?category=%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80" title="分类" data-v-33863c7e>编程语言</a></li> <li data-v-33863c7e><a href="/categories/?category=Java" title="分类" data-v-33863c7e>Java</a></li> <li data-v-33863c7e><a href="/categories/?category=JDBC" title="分类" data-v-33863c7e>JDBC</a></li></ul> <div class="info" data-v-33863c7e><div title="作者" class="author iconfont icon-touxiang" data-v-33863c7e><a href="https://github.com/HarrisonLee1998" target="_blank" title="作者" class="beLink" data-v-33863c7e>Harrison Lee</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-33863c7e><a href="javascript:;" data-v-33863c7e>2021-01-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          JDBC API概述
        </h1> <!----> <div class="theme-vdoing-content content__default"><p>使用JDBC操作数据源大致需要以下几个步骤：</p> <ul><li>与数据库建立连接</li> <li>执行SQL语句</li> <li>检索SQL执行结果</li> <li>关闭连接</li></ul> <h2 id="建立数据源连接"><a href="#建立数据源连接" class="header-anchor">#</a> 建立数据源连接</h2> <p>JDBC API中定义了<code>Connection</code>接口，用来表示与底层数据源的连接。应用程序可以使用两种方式获取<code>Connection</code>对象。</p> <ul><li><p><code>DriverManager</code>：JDBC 1.0规范中就已经存在，完全由JDBC API实现。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConection</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>JDBC 4.0之后的版本，创建<code>Connection</code>对象之前，不再需要通过<code>Class.forName(DriverPath)</code>显示地加载驱动类，<code>DriverManager</code>类通过SPI机制加载驱动。<code>DriverManager</code>中有三个<code>getConection()</code>的重载，根据数据库连接信息的不同可以使用不同的重载版本。</p></li> <li><p><code>DataSource</code>：这个接口是在JDBC 2.0规范可选包中引入的。它提供了比<code>DriverManager</code>更多的底层数据源相关的细节。相比<code>DriverManager</code>，这种方式不需要对连接信息进行硬编码。第二个优势体现在连接池和分布式事务上。</p></li></ul> <p>JDBC API中只提供了<code>DataSource</code>接口的定义，而没有提供实现，具体的实现由JDBC驱动程序提供，另外一些主流的数据库连接池（如Druid）也提供了实现。MyBatis框架中也提供了<code>DataSource</code>接口的实现，可以通过<code>DataSourceFactory</code>来获取。</p> <p>JDBC API中定义了两个<code>DataSource</code>接口比较重要的扩展，分别为：</p> <ul><li><code>ConnectionPoolDataSource</code>：支持缓存和复用<code>Conection</code>对象，在很大程度上提升应用性能和伸缩性。</li> <li><code>XADataSource</code>：该实例返回的<code>Connection</code>对象能够支持分布式事务。</li></ul> <h2 id="执行sql语句"><a href="#执行sql语句" class="header-anchor">#</a> 执行SQL语句</h2> <p>因为不同的数据库提供的操作可能会有差别，所以JDBC API中提供了<code>DataBaseMetadata</code>接口，应用程序可以使用该接口实例来确定目前使用的数据源是否支持某一特性。另外，JDBC API中还定义了转义语法，应用程序能够访问JDBC厂商提供的非标准特性。</p> <p>获取<code>Connection</code>对象之后，可以设置事务属性，并创建<code>Statement</code>等类型的对象。<code>Statement</code>可以理解为JDBC API中提供的SQL语句执行器，通过该实例对象调用方法执行相应操作。</p> <h2 id="处理sql语句执行结果"><a href="#处理sql语句执行结果" class="header-anchor">#</a> 处理SQL语句执行结果</h2> <p>SQL语句执行后，可以通过调用<code>getResultSet()</code>方法获取查询结果集，或者通过调用<code>getUpdateCount()</code>方法来获取更新操作影响的行数。前者返回<code>ResultSet</code>类型的实例，可以通过该实例获取结果集。</p> <h2 id="关闭连接"><a href="#关闭连接" class="header-anchor">#</a> 关闭连接</h2> <p>当我们使用完<code>Connection</code>对象后，需要显式地关闭该对象。可以通过<code>close()</code>方法关闭，还可以通过<code>isClosed()</code>方法判断连接是否关闭，同时通过<code>isValid()</code>方法判断连接是否有效。当连接关闭后或者是无效时，调用除了前面所说的几个方法外，将会抛出<code>SQLException</code>。</p> <h2 id="jdbc-api中的类与接口"><a href="#jdbc-api中的类与接口" class="header-anchor">#</a> JDBC API中的类与接口</h2> <p>前面讲了使用JDBC API的基本过程，JDBC API由java.sql和javax.sql两个包构成。</p> <h3 id="java-sql"><a href="#java-sql" class="header-anchor">#</a> java.sql</h3> <p>java.sql包含了最核心的API，可以把这些API分为数据类型接口，枚举类，驱动相关类和接口，异常类。</p> <p><img src="https://cdn.harrisonlee.net/image-20210108221028920.png" alt="image-20210108221028920"></p> <p><img src="https://cdn.harrisonlee.net/image-20210108221114835.png" alt="image-20210108221114835"></p> <p>除了这几类外，还有一些API，主要包括以下几个接口：</p> <p><img src="https://cdn.harrisonlee.net/image-20210108221138209.png" alt="image-20210108221138209"></p> <p>这些接口都继承自<code>java.sql.Wrapper</code>，该接口提供了程序访问原始类型的功能，从而使用JDBC驱动中一些非标准的特性。部分接口之间的关系如下图所示（注意不是严格的UML类图）：</p> <p><img src="https://cdn.harrisonlee.net/image-20210108220036404.png" alt="image-20210108220036404"></p> <h3 id="javax-sql"><a href="#javax-sql" class="header-anchor">#</a> javax.sql</h3> <p>javax.sql包中的类和接口最早是由JDBC 2.0版本的可选包提供的，这个可选包最早出现在J2SE 1.2版本中。该包主要包括了数据源，连接池相关，ResultSet的扩展和分布式扩展相关的API：</p> <p><img src="https://cdn.harrisonlee.net/image-20210108220840550.png" alt="image-20210108220840550"></p> <p>两个包的关系体现在通过<code>javax.sql.DataSource</code>获取<code>java.sql.Connection</code>实例。另外，javax.sql包还提供了一个<code>PooledConnection</code>接口，当应用程序调用<code>DataSource</code>对象的<code>getConnection()</code>方法时，返回一个<code>Connection</code>对象；但当使用数据库连接池时（如Druid），返回的实际上是<code>PooledConnection</code>对象，一般情况下，如果连接池中存在<code>PooledConnection</code>对象，则直接返回；否则通过<code>ConnectionPoolDataSource</code>对象的<code>getConnection()</code>方法创建新的连接。</p> <h2 id="driver与drivermanager"><a href="#driver与drivermanager" class="header-anchor">#</a> Driver与DriverManager</h2> <p>JDBC驱动的实现方式可能有很多种，主要包括以下几种：</p> <ul><li>JDBC-ODBC Bridge Driver</li> <li>Native API Driver</li> <li>JDBC-Net Driver</li> <li>Native Protocol Driver</li></ul> <p>最常使用的就是Native Protocol Driver，通常由数据库厂商直接提供。</p> <p>所有的JDBC驱动必须实现<code>java.sql.Driver</code>接口，而且实现类包含了一个静态初始化代码块，例如<code>com.mysql.cj.jdbc.Driver</code>中就包含如下代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>DriverManager</span><span class="token punctuation">.</span><span class="token function">registerDriver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> <span class="token class-name">E</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Can't register driver!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这也是为什么我们使用JDBC操作数据库时一般会先加载驱动，例如：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>Driver</code>接口中提供了一个<code>acceptsURL()</code>方法，<code>DriverManager</code>类可以通过<code>Driver</code>的实现类来调用该方法判断一个给定的URL是否能与数据库成功地建立连接。当我们试图调用<code>DriverManager</code>的<code>getConnection()</code>时，会调用<code>Driver</code>接口的<code>connect()</code>方法。</p> <p>JDBC 4.0及以上的版本可以不用手动加载驱动，原因是得益于Java的SPI机制，<code>DriverManager</code>可以通过<code>ServiceLoader</code>获取类路径下的所有的驱动，当然前提是这些驱动必须符合SPI的发现机制，比如对于mysql的驱动，在<strong>classpath:/META-INF/services/java.sql.Driver</strong>文件中保存了mysql的jdbc驱动：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Driver</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>另外，注意不同的JDK版本实现好像有不一致的地方，在Java11中，<code>DriverManager</code>不再是通过静态代码块加载驱动，而是在获取连接时（调用<code>getConnection()</code>时）进行懒加载，具体加载的逻辑在<code>ensureDriversInitialized()</code>方法中。</p> <h2 id="datasource"><a href="#datasource" class="header-anchor">#</a> DataSource</h2> <p><code>DataSource</code>对象用于表示能够提供数据库连接的数据源对象，如果数据库相关的信息发生了变化，则可以简单地修改<code>DataSource</code>对象的属性来反映这些变化，而不用修改应用程序的任何代码。</p> <p><code>DataSource</code>接口可以实现来提供以下两种功能：</p> <ul><li>通过连接池提高系统的性能和伸缩性</li> <li>通过<code>XADataSource</code>接口支持分布式事务。</li></ul> <p>同<code>DriverManager</code>一样，<code>DataSource</code>也提供了<code>getConnection()</code>方法，该方法同样调用了<code>Driver</code>实现类的<code>connect()</code>方法。</p> <p>实际项目中更多的是使用<code>DataSource</code>而不是<code>DriverManager</code>，而一般项目中不会直接创建<code>DataSource</code>实例，所以关于这部分内容的分析待后面分析到相应实现时再补充。</p> <h2 id="statement"><a href="#statement" class="header-anchor">#</a> Statement</h2> <p>前面提到，<code>Statement</code>相当于SQL执行器，该接口内部定义了执行SQL语句的方法。另外，API中还提供了<code>PreparedStatement</code>（继承自<code>Statement</code>）和<code>CallableStatement</code>（继承自<code>PreparedStatement</code>）这两个子接口。</p> <p>每个<code>Connection</code>实例可以创建多个<code>Statement</code>实例，并可以在创建时指定<code>ResultSet</code>的属性。</p> <p><code>Statement</code>中主要定义了三种执行SQL语句的方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ResultSet</span> <span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span> <span class="token comment">// 执行查询操作，返回结果集</span>
<span class="token keyword">int</span> <span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span> <span class="token comment">// 执行更新操作（增删改），返回受影响行数</span>
<span class="token comment">// 不区分查询还是更新，当返回true时，则表示是查询操作并可以获取ResultSet;如果是false,则表示是更新操作，可以获取受影响行数</span>
<span class="token keyword">boolean</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token keyword">int</span> autoGeneratedKeys<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>关于上述方法的重载以及其他更多方法请参考<code>Statement</code>的API文档。</p> <p><code>PreparedStatement</code>接口继承自<code>Statement</code>，在其基础上增加了占位符的功能（占位符为<code>?</code>）。<code>CallableStatement</code>在<code>PreparedStatement</code>的基础上增加了调用存储过程和检索调用结果的功能。</p> <p><code>Statemetn</code>执行完SQL后也需要关闭，可以通过调用其<code>close()</code>方法进行关闭，可以通过<code>isClosed()</code>方法判断是否已经关闭了。</p> <h2 id="resultset"><a href="#resultset" class="header-anchor">#</a> ResultSet</h2> <h3 id="游标操作方式和敏感性"><a href="#游标操作方式和敏感性" class="header-anchor">#</a> 游标操作方式和敏感性</h3> <p><code>ResultSet</code>提供了检索和操作SQL执行结果相关的方法，其属性主要体现在两个方面：</p> <ul><li>游标可操作的方式。</li> <li><code>ResultSet</code>对象的修改对数据库的影响（敏感性）。</li></ul> <p>一共有三种不同类型的<code>ResultSet</code>：</p> <ul><li><code>TYPE_FORWARD_ONLY</code>：不可滚动，游标只能向前移动，从第一行到最后一行，不能向后移动（默认为该值）。</li> <li><code>TYPE_SCROLL_INSENSITIVE</code>：可滚动，可以相对于当前位置移动，也可以移动到绝对位置。这种类型的<code>ResultSet</code>对数据库<strong>不</strong>敏感。</li> <li><code>TYPE_SCROLL_SENSITIVE</code>：可滚动，可以相对于当前位置移动，也可以移动到绝对位置。这种类型的<code>ResultSet</code>对数据库敏感。</li></ul> <p><code>DatabaseMetadata</code>接口中提供了一个<code>supportsResultSetType()</code>方法，用于判断数据库驱动是否支持某种类型的<code>ResultSet</code>对象。</p> <h3 id="并行性"><a href="#并行性" class="header-anchor">#</a> 并行性</h3> <p><code>ResultSet</code>对象的并行性决定了它支持更新的级别，目前JDBC中支持两个级别：</p> <ul><li><code>CONCUR_READ_ONLY</code>：表示只能从<code>ResultSet</code>对象中读取数据，不能更新数据（默认为该值）。</li> <li><code>CONCUR_UPDATABLE</code>：表示既可以读取数据，又可以更新数据。</li></ul> <p><code>DatabaseMetaData</code>接口中提供了一个<code>supportsResultSetConcurrency()</code>方法，判断JDBC驱动是否支持某一级别的并行性。</p> <h3 id="可保持性"><a href="#可保持性" class="header-anchor">#</a> 可保持性</h3> <p><code>ResultSet</code>的可保持性是指调用<code>Connection</code>的<code>commit()</code>方法后，是否关闭在当前事务中创建的<code>ResultSet</code>对象。下面两个常量可以用来在创建<code>Statement</code>实例时指定<code>ResultSet</code>的可保持性：</p> <ul><li><code>HOLD_CURSORS_OVER_COMMIT</code>：提交事务时，不关闭<code>ResultSet</code>对象。</li> <li><code>CLOSE_CURSORS_AT_COMMIT</code>：提交事务时，关闭<code>ResultSet</code>对象，从而可以提高性能。</li></ul> <p>默认可保持性取决于驱动的实现，</p> <h3 id="关闭resultset"><a href="#关闭resultset" class="header-anchor">#</a> 关闭ResultSet</h3> <p>在下面两种情况下，<code>ResultSet</code>会被显式地关闭：</p> <ul><li>调用其自身的<code>close()</code>方法。</li> <li>调用创建<code>ResultSet</code>对象的<code>Statement</code>或相关联的<code>Connection</code>的<code>close()</code>方法。</li></ul> <p>在下面两种情况下，<code>ResultSet</code>会被隐式地关闭：</p> <ul><li>相关联的<code>Statement</code>实例重复执行时。</li> <li>可保持性为<code>CLOSE_CURSORS_AT_COMMIT</code>的<code>ResultSet</code>对象在事务提交后会被关闭。</li></ul> <h2 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h2> <p>JDBC API中的事务管理符合SQL:2003规范，主要包含下面几个概念：</p> <ul><li>自动提交模式</li> <li>事务隔离级别</li> <li>保存点</li></ul> <h2 id="databasemetadata"><a href="#databasemetadata" class="header-anchor">#</a> DatabaseMetaData</h2> <p><code>DatabaseMetaData</code>接口用于提供底层数据源相关的信息，该接口主要用于为应用程序或工具确定如何与底层数据源交互。该接口提供了很多方法，主要可以分为以下几类：</p> <ul><li>获取数据源信息</li> <li>确定数据源是否支持某一特性或功能</li> <li>获取数据源限制</li> <li>确定数据源包含哪些JDBC对象以及这些对象的属性</li> <li>获取数据源对事务的支持</li></ul> <p>具体信息请参考对应的Java Doc。</p> <h2 id="常见数据库的驱动实现类名和url格式"><a href="#常见数据库的驱动实现类名和url格式" class="header-anchor">#</a> 常见数据库的驱动实现类名和URL格式</h2> <h3 id="mysql"><a href="#mysql" class="header-anchor">#</a> MySQL</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Driver</span> <span class="token comment">// 旧</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Driver</span> <span class="token comment">// 新</span>
jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token generics"><span class="token punctuation">&lt;</span>host<span class="token punctuation">&gt;</span></span><span class="token operator">:</span><span class="token generics"><span class="token punctuation">&lt;</span>port<span class="token punctuation">&gt;</span></span><span class="token operator">/</span><span class="token generics"><span class="token punctuation">&lt;</span>database_name<span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token operator">?</span><span class="token generics"><span class="token punctuation">&lt;</span>parameter1<span class="token operator">&amp;</span>parameter2<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="oracle"><a href="#oracle" class="header-anchor">#</a> Oracle</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">oracle<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>driver<span class="token punctuation">.</span></span>OracleDriver</span>
jdbc<span class="token operator">:</span>oracle<span class="token operator">:</span>@<span class="token comment">//&lt;host&gt;:&lt;port&gt;/&lt;database_name&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://book.douban.com/subject/34836563/" target="_blank" rel="noopener noreferrer">《MyBatis 3源码深度解析》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=Java" title="标签">#Java</a><a href="/tags/?tag=JDBC" title="标签">#JDBC</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021-03-21</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/5825a9/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Java方法调用</div></a> <a href="/pages/856738/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">JavaScript中的变量与作用域</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/5825a9/" class="prev">Java方法调用</a></span> <span class="next"><a href="/pages/856738/">JavaScript中的变量与作用域</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/0c4c2e/"><div>Spring AOP基础</div></a> <span>02-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/e0358f/"><div>SpringBoot中Filter的注册</div></a> <span>02-07</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/226a87/"><div>Java中的Lambda表达式及原理</div></a> <span>01-29</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:lzipant@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/HarrisonLee1998" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2021
    <span>Harrison Lee | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.36e91a11.js" defer></script><script src="/assets/js/2.409e0185.js" defer></script><script src="/assets/js/23.99984d12.js" defer></script>
  </body>
</html>